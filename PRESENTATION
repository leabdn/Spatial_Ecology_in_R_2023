# PROBLEMATIC CHOSEN
# To what extent does the creation of ecological corridors (rivers) affect the presence of Aeshna affinis in the Centre-Val-de-Loire french region ?
As historic gardens, with their specific ecologics characteristics, have an higher level of biodiversity the green spaces in Tours Métropole (Indre-et-Loire department, France) ?

# STEP 1. SHOW IF THE OCCURENCE ARE FAR FROM THE HISTORIC GARDENS AND THE GREEN SPACES IN THE TWO YEARS (HYPOTHESIS)

# OPEN THE data_Aeshna_affinis.shp FILE
install.packages("terra")
library(terra)
fileA <- setwd("C:/Users/leabd/Documents/Erasmus courses/SPATIAL ECOLOGY IN R/FINAL PRESENTATION/AESHNA")
Aeshna <- vect(file) # Insert the shape file
Aeshna # Informations about geometry data of Aeshna
plot(Aeshna) # Plot the presence (points) of Aeshna

# ADD THE historicgardens.shp FILE ON THE GRAPH
fileHG <- setwd("C:/Users/leabd/Documents/Erasmus courses/SPATIAL ECOLOGY IN R/FINAL PRESENTATION/HISTORIC GARDENS")
Historicgardens <- vect(file) # Insert the shape file
Historicgardens # Informations about geometry data of the Historic gardens
points(Historicgardens, col = "red")

# ADD THE gardensspaces.shp FILE ON THE GRAPH
fileGS <- setwd("C:/Users/leabd/Documents/Erasmus courses/SPATIAL ECOLOGY IN R/FINAL PRESENTATION/GARDEN_SPACES")
Gardensspaces <- vect(file) # Insert the shape file
Gardensspaces # Informations about geometry data of Garden spaces
points(Gardensspaces, col = "red")


# PLOT THE DATA IN THE SAME 


# STEP 2. CALCULATIONS OF COMPLEMENTARY VEGETATION AND WATER INDEX (COMPARISON IN 2020 AND 2021) : THE NDVI AND THE NDWI TO EVALUATE THIS LINK

# CALCULATE THE NDVI
install.packages("ggplot2") # Use colours scales
install.packages("viridis") # Make the plot more aesthetic
install.packages("devtools")
install.packages("htmltools") # Have the last version of devtools
install.packages("terra")
library(ggplot2) 
library(viridis)
library(devtools)
library(htmltools)
library(terra) # predictors
devtools::install_github("ducciorocchini/imageRy")
library(imageRy)
setwd("C:/Users/leabd/Documents/Erasmus courses/SPATIAL ECOLOGY IN R/FINAL PRESENTATION/DATA") # path we we found the .jpg
recentjpg <- rast("2023-07-07-00_00_2023-07-07-23_59_Sentinel-2_L1C_True_color.jpg")
redband <- im.plotRGB(recentjpg, 1, 2, 3) # Red band
blueband <- im.plotRGB(recentjpg, 2, 3, 1) # Blue band
greenband <- im.plotRGB(recentjpg, 2, 1, 3) # Green band
ndvi2023 = (recentjpg[[1]] - recentjpg[[2]]) / (recentjpg[[1]] + recentjpg[[2]]) # (NIR-RED) / (NIR+RED)
ndvi2023
cl <- colorRampPalette(c("darkblue", "yellow", "red", "black"))(100) # Specifying a colour scheme
plot(ndvi2023, col=cl)

# CALCULATION OF THE NDWI
ndwi2023 = (recentjpg[[3]] - recentjpg[[1]]) / (recentjpg[[3]] + recentjpg[[1]])
ndwi2023
c <- colorRampPalette(c("darkblue", "blue", "green", "yellow")) (100)
plot(ndwi2023, col = c)

# STEP 3. CORRELATIONS BETWEEN INDICES (FOR HISTORIC GARDENS AND GREENSPACES) AND OCCURENCE OF Aeshna affinis (during the oral)




-------------------------------------------------------------------------------------------------------------------------
cgray <- colorRampPalette(c("black", "dark gray", "gray")) (100) # Bands in grey
plot(ndwi2023, col = cgray)

# STEP 1. OPEN THE SENTINEL-2 DATA IN R STUDIO
install.packages("terra")
library(terra)
setwd("C:/Users/leabd/Documents/Erasmus courses/SPATIAL ECOLOGY IN R/FINAL PRESENTATION/DATA") # path we we found the .jpg
recentjpg <- rast("2023-07-07-00_00_2023-07-07-23_59_Sentinel-2_L1C_True_color.jpg")
plotRGB(recentjpg, r=1, g=2, b=3)

# STEP 1. OPEN THE CSV FILE IN R STUDIO (AESHNA AFFINIS OBSERVATIONS)
install.packages("rio")
library(rio)
path <- "C:/Users/leabd/Documents/Erasmus courses/SPATIAL ECOLOGY IN R/PRESENTATION/data_Aeshna_affinis.xlsx"
data <- import_list(path)
print (data)

# STEP 2. OPEN THE SHP FILE IN R STUDIO (RIVERS)
install.packages("sdm")
library(sdm)
shpfile <- system.file("external/Corridors_terrestres_et_aquatiques.shp", package="sdm")
shpfile

# STEP 1. OPEN THE SENTINEL-2 DATA IN R STUDIO
# THE OLDER RASTER : 06/07/2015
install.packages("terra")
library(terra)
setwd("C:/Users/leabd/Documents/Erasmus courses/SPATIAL ECOLOGY IN R/FINAL PRESENTATION/DATA") # path we we found the .jpg
olderjpg <- rast("2015-07-06-00_00_2015-07-06-23_59_Sentinel-2_L1C_True_color.jpg") 
olderjpg # plot the informations of the raster
plotRGB(olderjpg, r=1, g=2, b=3) # plot the raster in real colours
# THE MOST RECENT RASTER : 06/07/2023
recentjpg <- rast("2023-07-07-00_00_2023-07-07-23_59_Sentinel-2_L1C_True_color.jpg")
plotRGB(recentjpg, r=1, g=2, b=3)

# STEP 3. CALCULATE THE DVI AND NDVI TO COMPARE THE EVOLUTION BETWEEN 2015 AND 2023
install.packages("ggplot2") # Use colours scales
install.packages("viridis") # Make the plot more aesthetic
library(ggplot2) 
library(viridis)
dvi2015 = olderjpg[[1]] - olderjpg [[2]]
dvi2015
dvi2023 = recentjpg[[1]] - recentjpg [[2]]
dvi2023
cl <- colorRampPalette(c("darkblue", "yellow", "red", "black"))(100) # Specifying a colour scheme
plot(dvi2015, col=cl)
plot(dvi2023, col=cl)

# NDWI WITH LANDSAT DATA (not possible to download finally)
b8 <- # NIR FROM SENTINEL (TIF FORMAT)
b13 <- # MIR FROM SENTINEL (TIF FORMAT)
cgrey <- colorRampPalette(c("black", "dark gray", "gray")) (100) # Bands in grey
ndwi2023 = ((b8-b13)/(b8+b13)) # NDWI = (NIR-MIR) / NIR+MIR)

# CALCULATE THE NDWI
install.packages("raster")
install.packages("rgdal")
library (raster)
library (rgdal)
path <- system.file ("C:/Users/leabd/Documents/Erasmus courses/SPATIAL ECOLOGY IN R/FINAL PRESENTATION/DATA/NDWI", package = "ASIP") # Path to access at recentjpg
shapefile <- paste0 (path, "/test.shp")
ndwi2023 <- ndwi (directory = path, crop = "y", ext2crop = shapefile)
# (BIRGHTNESS INDEX), BI = root((Red²+Green²)/2)
x1 <- recentjpg[[1]] # NIR
y1 <- 2
x1^y1
x2 <- recentjpg[[3]] # GREEN
y2 <- 2
y1^y2
# The power

--------------------------------------------------------------------------------------------------------------------------------------------
rastfile <- setwd("C:/Users/leabd/Documents/Erasmus courses/SPATIAL ECOLOGY IN R/FINAL PRESENTATION/DATA")
rastersentinel <- rast(rastfile)

# CALCULATE OF THE DVI
dvi2023 = recentjpg[[1]] - recentjpg [[2]]
dvi2023
cl <- colorRampPalette(c("darkblue", "yellow", "red", "black"))(100) # Plot a colour scheme for the DVI
plot(dvi2023, col=cl)

install.packages("readr")
library(readr)
mysource <- "C:/Users/leabd/Documents/Erasmus courses/SPATIAL ECOLOGY IN R/PRESENTATION"
file = paste0(mysource,"data_Aeshna_affinis_csv")
header = TRUE
sep = ",",
stringsAsFactors = TRUE
str("data_Aeshna_affinis_csv")

